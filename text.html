<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ–‡ç« ãŠé¡Œ | RxD Base</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root{
      --bg:#F5EBFA; --ink:#222; --card:#fff; --pink:#FF93C2; --mint:#7FE7DB;
      --ink2:#555; --line:#DDD; --sun:#FFF59F;
      --target-accent: var(--mint);
      --sharew: 56px;                /* â† ç¸¦ãƒœã‚¿ãƒ³åˆ—ã®å¹…ï¼ˆã‚«ãƒ¼ãƒ‰å·¦ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¨é€£å‹•ï¼‰ */
    }
    html{ background:var(--bg); color:var(--ink);
      font-family:'Noto Sans JP','Kosugi Maru','M PLUS Rounded 1c',system-ui,sans-serif; }
    body{ margin:0; min-height:100vh; scroll-behavior:smooth; }
    .container{ max-width:820px; margin:0 auto; padding:24px 12px 56px; }
    .logoimg{ width:56px; height:56px; border-radius:50%; display:block; margin:0 auto 8px; }
    h1{ margin:0 0 12px; font-size:1.9rem; font-weight:800; letter-spacing:.03em; text-align:center; }
    hr.cute{ border:none; border-top:2.5px dashed var(--pink); margin:18px auto 26px; width:90%; }
    .desc{ text-align:center; font-size:1.04rem; color:var(--ink2); margin-bottom:20px; }

    .cards{ display:grid; grid-template-columns:1fr; gap:20px; }

    .card{
      background:var(--card);
      border:2.5px solid var(--pink);
      border-radius:16px;
      box-shadow:0 2px 12px #7FE7DB20;
      transition:box-shadow .18s, border-color .18s, background .18s;
      position:relative;
      scroll-margin-top: 16px;
      overflow:hidden;
    }
    .card:hover{ box-shadow:0 4px 24px #FF93C288; border-color:var(--mint); }

    /* ãƒãƒƒã‚·ãƒ¥ä¸€è‡´ã§ã®å¼·èª¿ï¼ˆJSãŒ .is-target ã‚’ä»˜ä¸ï¼‰ */
    .card.is-target{
      background:linear-gradient(180deg,#fff 0%, #fff6fb 55%, #fff 100%);
      border-color:var(--target-accent);
      box-shadow:0 0 0 3px #7FE7DB66, 0 8px 28px #FF93C244;
    }
    .card.is-target .cardtitle{ color:var(--target-accent); }
    .card:target{ background:linear-gradient(180deg,#fff 0%, #fff6fb 55%, #fff 100%); border-color:var(--target-accent); }

    /* å·¦ä¸Šã®ç¸¦ã‚·ã‚§ã‚¢åˆ— */
    .sharecol{
      position:absolute; inset:8px auto auto 8px;
      display:flex; flex-direction:column; gap:6px; width:var(--sharew);
    }
    .sharebtn{
      border:none; border-radius:8px; padding:3px 8px;
      font-size:.72rem; font-weight:700; line-height:1.8;
      cursor:pointer; transition:background .18s, opacity .18s;
    }
    .sharebtn[disabled]{ opacity:.6; cursor:default; }
    .urlbtn{ background:var(--sun); color:#555; }
    .urlbtn:hover{ background:var(--pink); color:#fff; }
    .xbtn{ background:#111; color:#fff; opacity:.9; }
    .xbtn:hover{ background:#000; opacity:1; }
    .sysbtn{ background:var(--mint); color:#222; }
    .sysbtn:hover{ background:#FF93C2; color:#fff; }

    /* ãƒ˜ãƒƒãƒ€ï¼ˆã‚¿ã‚¤ãƒˆãƒ«æŠ¼ä¸‹ã§é–‹é–‰ï¼‰â€”å·¦ã«ã‚·ã‚§ã‚¢åˆ—ã¶ã‚“ã®ä½™ç™½ã‚’ç¢ºä¿ */
    .cardhead{
      display:flex; gap:10px; align-items:flex-start;
      padding:14px 16px 8px calc(var(--sharew) + 16px);
      cursor:pointer; user-select:none;
    }
    .toggle{
      flex:0 0 auto; width:22px; height:22px; line-height:22px;
      border-radius:50%; background:#fff4fb; border:2px solid var(--pink);
      color:var(--pink); font-weight:900; font-size:.9rem; text-align:center;
      margin-top:2px;
    }
    .cardtitle{ font-size:1.12rem; font-weight:800; color:var(--pink); }
    .carddesc{ font-size:1rem; color:var(--ink2); margin-top:2px; }

    /* æœ¬æ–‡éƒ¨ï¼šæœ€åˆã¯ â€œ2è¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºâ€ */
    .cardcontent{ padding:0 10px 10px 10px; display:block; }
    .card.is-collapsed .promptarea{
      white-space: pre-wrap; line-height: 1.6; overflow: hidden;
      height: calc(1.6em * 2 + 20px);           /* 2è¡Œ + ä¸Šä¸‹padding */
      -webkit-mask-image: linear-gradient(to right, black 85%, transparent);
              mask-image: linear-gradient(to right, black 85%, transparent);
    }

    .promptarea{
      box-sizing:border-box; width:100%; display:block;
      background:#F8F7FD; border:1.5px solid var(--line); border-radius:10px;
      color:#333; font-size:.98rem; line-height:1.6; letter-spacing:.01em;
      padding:10px 10px; margin-top:8px;
      resize:none; overflow:hidden; white-space:pre-wrap;
    }

    .btnrow{ margin-top:10px; display:flex; gap:8px; align-items:center; }
    .copybtn{
      background:var(--mint); color:var(--ink); font-weight:800; border:none; border-radius:10px;
      padding:8px 12px; font-size:.95rem; cursor:pointer; transition:background .18s, transform .06s;
    }
    .copybtn:hover{ background:#FF93C2; color:#fff; }
    .copybtn:active{ transform:translateY(1px); }
    .copybtn[disabled]{ opacity:.7; cursor:default; }

    /* å³ä¸Šï¼šâ–² */
    .gotop{
      position:absolute; top:8px; right:12px; font-size:0.9rem; text-decoration:none; color:var(--ink2);
    }
    .gotop:hover{ color:var(--pink); }

    .backlink{
      display:inline-block; background:var(--mint); color:var(--ink); font-weight:bold;
      text-decoration:none; border-radius:8px; padding:6px 14px; margin:12px auto; transition:background .18s;
    }
    .backlink:hover{ background:#FF93C2; color:#fff; }

    .footer{ text-align:center; margin-top:40px; color:#B3A9D6; font-size:.96rem; }

    @media (max-width:600px){
      .container{ padding:14px 8px 36px; }
      .cardhead{ padding:12px 12px 6px calc(var(--sharew) + 12px); }
      .cardcontent{ padding:0 12px 12px; }
      .copybtn{ padding:8px 10px; font-size:.92rem; }
    }

    @media (prefers-reduced-motion:reduce){
      *{ transition:none !important; animation:none !important; }
    }

    .highlight { animation: flash 1.8s ease; }
    @keyframes flash {
      0% { box-shadow:0 0 0 #FF93C200; }
      30% { box-shadow:0 0 18px #FF93C288; }
      100% { box-shadow:0 0 0 #FF93C200; }
    }
  </style>
</head>
<body id="top">
  <div class="container">
    <a href="index.html" class="backlink">â† indexã«æˆ»ã‚‹</a>

    <img src="rxd-logo.png" class="logoimg" alt="RxDãƒ­ã‚´">
    <h1>æ–‡ç« ãŠé¡Œ</h1>
    <hr class="cute">
    <p class="desc">ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ¼ã™ã¨å…¨æ–‡ãŒé–‹ãã‚ˆã€‚<br>æ”¹å¤‰æ¨å¥¨ / å ±å‘Šä¸è¦ / å…¨ã¦è‡ªç”±ğŸ’‹</p>
    <hr class="cute">

    <div class="cards" id="cards"><div style="opacity:.6">èª­ã¿è¾¼ã¿ä¸­â€¦</div></div>

    <a href="index.html" class="backlink">â† indexã«æˆ»ã‚‹</a>
    <div class="footer">&copy; 2025 Secret Base (Rag and Duster)</div>
  </div>

  <script>
    /* ===== utils ===== */
    function humanizeId(id){ return id.replace(/[_-]+/g,' ').replace(/\s+/g,' ').trim().replace(/^./, s=>s.toUpperCase()); }
    function autosize(ta){ if(!ta) return; ta.style.height='auto'; ta.style.height=ta.scrollHeight+'px'; }
    function cardUrl(id){ return `${location.origin}${location.pathname}#${encodeURIComponent(id)}`; }

    async function copyPrompt(id, btn){
      const el = document.getElementById(id);
      const text = (el?.value ?? el?.textContent ?? '').trim();
      if(!text) return;
      try{
        if(navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
        }else{
          const r=document.createRange(); r.selectNodeContents(el);
          const s=window.getSelection(); s.removeAllRanges(); s.addRange(r);
          document.execCommand('copy'); s.removeAllRanges();
        }
        flash(btn,true);
      }catch(_){ flash(btn,false); }
    }
    function flash(btn, ok){
      const o=btn.textContent; btn.textContent= ok?'ã“ã´ã—ãŸï¼':'å¤±æ•—ï¼Ÿ';
      btn.disabled=true; setTimeout(()=>{ btn.textContent=o; btn.disabled=false; },1600);
    }
    async function copyUrl(id, btn){
      try{ await navigator.clipboard.writeText(cardUrl(id)); const o=btn.textContent; btn.textContent='urlã“ã´ã—ãŸï¼'; btn.disabled=true; setTimeout(()=>{ btn.textContent=o; btn.disabled=false; },1600); }
      catch{ const o=btn.textContent; btn.textContent='å¤±æ•—ï¼Ÿ'; setTimeout(()=>btn.textContent=o,1200); }
    }

    // Xå…±æœ‰ï¼šã‚¹ãƒãƒ›ã¯åŒã‚¿ãƒ– twitter.comã€PCã¯åˆ¥ã‚¿ãƒ– x.com
    function shareToX(id, title){
      const text = `ã€ãŠé¡Œã€‘${title || humanizeId(id)}\n${cardUrl(id)}`;
      const isMobile = /iPhone|iPad|iPod|Android|Mobile/i.test(navigator.userAgent);
      const webMobile  = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
      const webDesktop = `https://x.com/intent/post?text=${encodeURIComponent(text)}`;
      if (isMobile) location.href = webMobile;
      else window.open(webDesktop, '_blank', 'noopener,width=640,height=520');
    }

    // OSå…±æœ‰ï¼šãªã‘ã‚Œã° text ã‚’ã‚³ãƒ”ãƒ¼
    async function shareSystem(id, title, btn){
      const text = `ã€ãŠé¡Œã€‘${title || humanizeId(id)}\n${cardUrl(id)}`;
      if(navigator.share){
        try{ await navigator.share({ text }); return; }catch{}
      }
      try{
        await navigator.clipboard.writeText(text);
        const o=btn.textContent; btn.textContent='copy!'; btn.disabled=true; setTimeout(()=>{ btn.textContent=o; btn.disabled=false; },1200);
      }catch{
        window.open(cardUrl(id),'_blank'); // æœ€å¾Œã®é€ƒã’é“
      }
    }

    /* ===== hash target highlight & jump ===== */
    function setTargetCardClass(){
      document.querySelectorAll('.card.is-target').forEach(c=>c.classList.remove('is-target'));
      if(!location.hash) return;
      const id = decodeURIComponent(location.hash.slice(1));
      const el = document.getElementById(id);
      if(el) el.classList.add('is-target');
    }
    function focusCardByHash(behavior='smooth'){
      setTargetCardClass();
      if(!location.hash) return;
      const id = decodeURIComponent(location.hash.slice(1));
      const el = document.getElementById(id);
      if(!el) return;
      openCard(el,false);
      el.scrollIntoView({behavior, block:'center'});
      el.classList.add('highlight');
      setTimeout(()=> el.classList.remove('highlight'), 2000);
    }
    window.addEventListener('hashchange', ()=> focusCardByHash('smooth'));
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) focusCardByHash('smooth'); });

    /* ===== open/close ===== */
    function openCard(card, scroll=true){
      const head = card.querySelector('.cardhead');
      if(!head) return;
      head.setAttribute('aria-expanded','true');
      head.querySelector('.toggle').textContent='â–²';
      card.classList.remove('is-collapsed');
      const ta = card.querySelector('.promptarea');
      if(ta){ ta.style.whiteSpace='pre-wrap'; autosize(ta); }
      if(scroll) card.scrollIntoView({behavior:'smooth', block:'center'});
    }
    function closeCard(card){
      const head = card.querySelector('.cardhead');
      if(!head) return;
      head.setAttribute('aria-expanded','false');
      head.querySelector('.toggle').textContent='â–½';
      card.classList.add('is-collapsed');
      const ta = card.querySelector('.promptarea');
      if(ta){ ta.style.whiteSpace=''; ta.style.height=''; }
    }
    function toggleCard(card){ if(card.classList.contains('is-collapsed')) openCard(card); else closeCard(card); }

    /* ===== build ===== */
    async function buildCards(){
      const wrap = document.getElementById('cards');
      if(!wrap) return;

      try{
        const res = await fetch('text_prompt/00caption.txt', {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const text = await res.text();

        const lines = text.split(/\r?\n/)
          .map(s=>s.trim())
          .filter(s => s && !s.startsWith('#') && !s.startsWith('//'));

        wrap.innerHTML = '';

        for(const line of lines){
          const parts = line.split('<>');
          const id = (parts[0]||'').trim();
          if(!id) continue;

          const hasThree = parts.length >= 3;
          const title = hasThree ? (parts[1]||'').trim() : humanizeId(id);
          const desc  = hasThree ? (parts[2]||'').trim() : (parts[1]||'').trim();

          // ---- card ----
          const card = document.createElement('div');
          card.className = 'card is-collapsed';
          card.id = id;

          const gotop = document.createElement('a');
          gotop.href = '#top'; gotop.className = 'gotop'; gotop.textContent = 'â–²';

          /* å·¦ä¸Šãƒ»ç¸¦ã‚·ã‚§ã‚¢åˆ— */
          const share = document.createElement('div');
          share.className = 'sharecol';

          const bUrl = document.createElement('button');
          bUrl.type='button'; bUrl.className='sharebtn urlbtn'; bUrl.textContent='url';
          bUrl.addEventListener('click', ()=> copyUrl(id, bUrl));
          share.appendChild(bUrl);

          const bX = document.createElement('button');
          bX.type='button'; bX.className='sharebtn xbtn'; bX.textContent='X';
          bX.title='Xã§ãƒã‚¹ãƒˆ';
          bX.addEventListener('click', ()=> shareToX(id, title || humanizeId(id)));
          share.appendChild(bX);

          const bSys = document.createElement('button');
          bSys.type='button'; bSys.className='sharebtn sysbtn'; bSys.textContent='ğŸ”—';
          bSys.title='å…±æœ‰ï¼ˆOSã®å…±æœ‰UIï¼‰';
          bSys.addEventListener('click', ()=> shareSystem(id, title || humanizeId(id), bSys));
          share.appendChild(bSys);

          const head = document.createElement('div');
          head.className = 'cardhead';
          head.setAttribute('role','button');
          head.setAttribute('tabindex','0');
          head.setAttribute('aria-expanded','false');

          const tg = document.createElement('div'); tg.className = 'toggle'; tg.textContent = 'â–½';
          const titleBox = document.createElement('div');
          const ttl = document.createElement('div'); ttl.className = 'cardtitle'; ttl.textContent = title || humanizeId(id);
          const dsc = document.createElement('div'); dsc.className = 'carddesc'; dsc.textContent = desc || '';
          titleBox.appendChild(ttl); titleBox.appendChild(dsc);

          head.appendChild(tg); head.appendChild(titleBox);

          const content = document.createElement('div'); content.className = 'cardcontent';

          const ta = document.createElement('textarea');
          ta.className = 'promptarea'; ta.readOnly = true; ta.id = `prompt-${id}`;

          const btnrow = document.createElement('div'); btnrow.className = 'btnrow';
          const btn = document.createElement('button'); btn.type='button'; btn.className = 'copybtn'; btn.textContent = 'ã‚³ãƒ”ãƒ¼';
          btn.addEventListener('click', ()=>copyPrompt(ta.id, btn));
          btnrow.appendChild(btn);

          content.appendChild(ta);
          content.appendChild(btnrow);

          card.appendChild(gotop);
          card.appendChild(share);     /* â† ã“ã“ã§ç¸¦ãƒœã‚¿ãƒ³ã‚’é…ç½® */
          card.appendChild(head);
          card.appendChild(content);
          wrap.appendChild(card);

          // é–‹é–‰ã‚¤ãƒ™ãƒ³ãƒˆ
          head.addEventListener('click', ()=> toggleCard(card));
          head.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggleCard(card); }});

          // æœ¬æ–‡ãƒ­ãƒ¼ãƒ‰
          fetch(`text_prompt/${id}.txt`, {cache:'no-store'})
            .then(r=>r.ok?r.text():'')
            .then(t=>{
              ta.value = t || '(èª­ã¿è¾¼ã¿å¤±æ•—)';
              if(!card.classList.contains('is-collapsed')) autosize(ta);
            })
            .catch(()=>{ ta.value='(èª­ã¿è¾¼ã¿å¤±æ•—)'; });
        }

        if(!wrap.children.length){
          wrap.innerHTML = '<div style="opacity:.6">ï¼ˆãŠé¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼‰</div>';
        }

        // ç”Ÿæˆå®Œäº†å¾Œã€#id ãŒã‚ã‚Œã°é–‹ã„ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼†å¼·èª¿
        requestAnimationFrame(()=> focusCardByHash('auto'));
        setTimeout(()=> focusCardByHash('auto'), 150);

      }catch(e){
        wrap.innerHTML = '<div style="opacity:.7">èª­ã¿è¾¼ã¿å¤±æ•—â€¦ '+(e.message||e)+'</div>';
      }
    }

    window.addEventListener('DOMContentLoaded', buildCards);
  </script>
</body>
</html>
